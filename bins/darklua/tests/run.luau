local toolchainlib = require("../lune_packages/core")
local process = require("@lune/process")
local fs = require("@lune/fs")

return function(version)
	-- not working, needing support
	-- process.args = { "bins/zap/tests/input.zap" }
	local success, err = pcall(require, "bins/blink/init.luau")
	assert(success, `failed to execute blink: {err}`)

	local client_signature = `\n-- Client generated by Zap v{version} (https://github.com/red-blox/zap)`
	assert(fs.readFile("tests/output/client.luau"):match(client_signature), `invalid output`)

	local server_signature = `\n-- Server generated by Zap v{version} (https://github.com/red-blox/zap)`
	assert(fs.readFile("tests/output/server.luau"):match(server_signature), `invalid output`)
end
