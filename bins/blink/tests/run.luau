local toolchainlib = require("../lune_packages/core")
local process = require("@lune/process")
local fs = require("@lune/fs")

return function(version)
	-- not working, needing support
	-- process.args = { "bins/blink/tests/input.blink" }
	local success, err = pcall(require, "bins/blink/init.luau")
	assert(success, `failed to execute blink: {err}`)

	local client_signature = `\n-- File generated by Blink v{version}`
	assert(fs.readFile("bins/blink/tests/output/client.luau"):match(client_signature), `invalid output`)

	local server_signature = `\n-- File generated by Blink v{version}`
	assert(fs.readFile("bins/blink/tests/output/server.luau"):match(server_signature), `invalid output`)
end
